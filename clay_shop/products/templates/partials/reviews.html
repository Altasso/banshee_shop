{% if reviews %}
    {% for review in reviews %}
    <div class="card mb-3" id="review-{{ review.id }}">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                    <strong>{{ review.user.get_full_name|default:review.user.username }}</strong>
                    <div class="text-warning">
                        {% for i in "12345"|slice:":review.rating" %}
                            <i class="bi bi-star-fill"></i>
                        {% endfor %}
                        {% for i in "12345"|slice:"review.rating:" %}
                            <i class="bi bi-star"></i>
                        {% endfor %}
                    </div>
                </div>
                <small class="text-muted">{{ review.created_at|date:"d.m.Y H:i" }}</small>
            </div>
            <p class="mb-2">{{ review.comment }}</p>
            
            {% if review.user == request.user %}
            <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-primary" 
                        data-bs-toggle="modal" 
                        data-bs-target="#editReviewModal"
                        hx-get="{% url 'products:get_review' review.id %}"
                        hx-target="#editReviewForm">
                    <i class="bi bi-pencil"></i> Редактировать
                </button>
                <button class="btn btn-outline-danger"
                        hx-delete="{% url 'products:delete_review' review.id %}"
                        hx-target="#review-{{ review.id }}"
                        hx-swap="outerHTML"
                        hx-confirm="Удалить отзыв?">
                    <i class="bi bi-trash"></i> Удалить
                </button>
            </div>
            {% endif %}
            
            <!-- Кнопки полезности -->
            <div class="mt-3">
                <button class="btn btn-sm btn-outline-success"
                        hx-post="{% url 'products:review_helpful' review.id %}"
                        hx-vals='{"helpful": true}'
                        hx-target="#review-{{ review.id }}"
                        hx-swap="outerHTML">
                    <i class="bi bi-hand-thumbs-up"></i> Полезно ({{ review.helpful_count }})
                </button>
                <button class="btn btn-sm btn-outline-danger"
                        hx-post="{% url 'products:review_helpful' review.id %}"
                        hx-vals='{"helpful": false}'
                        hx-target="#review-{{ review.id }}"
                        hx-swap="outerHTML">
                    <i class="bi bi-hand-thumbs-down"></i> Не полезно ({{ review.not_helpful_count }})
                </button>
            </div>
        </div>
    </div>
    {% endfor %}
{% else %}
    <div class="alert alert-info">
        <i class="bi bi-chat-left-text"></i> Пока нет отзывов. Будьте первым!
    </div>
{% endif %}